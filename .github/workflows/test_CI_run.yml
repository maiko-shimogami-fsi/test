name: form-example 
on:
 workflow_dispatch:
    inputs:
      input_mod:
        description: 'Please enter the SHA-1 or branch name to UnitTest.'
        required: false
        
 workflow_call:
    inputs:
      input_mod:
        type: string

jobs:
    call_check-bats-version1:
      runs-on: ubuntu-latest
      
      steps:
      #環境を設定する
        - name: step1
          uses: actions/checkout@v4
        - run: |
             echo "checkout"
             
      #コンポの値設定
        - name: compo_check
          run: |
             #targetcompo=${{ inputs.input_mod }}
             #echo "targetcompo=$targetcompo"
             
    call_check-bats-version2:
      runs-on: ubuntu-latest
      needs: [ call_check-bats-version1 ]

      steps:
      #チェック確認
        - name: step1
          id: step1
          run: |
            if [ ${{ inputs.input_mod }} = 'Lcd' ]; then
              echo "エラー"
              exit 1
            fi
 
    call_check-bats-version3:
      runs-on: windows-latest
      needs: [ call_check-bats-version1,call_check-bats-version2 ]

      steps:
        #環境を設定する
        - name: step1
          uses: actions/checkout@v4
        - run: |
             echo "checkout"
             
        - name: step2
          id: step2
          run: |
            [string[]]$targetcompo = @()

             foreach ($l in Get-Content ./unittest_setting.json) {
              if ($l -like "*node_name*") {
                $node_name = $l.Substring(22, ($l.Length-24))
               } elseif ($l -like "*scheduled*") {
                if ($l -like "*true*") {
                  $targetcompo += $node_name
                  }
               }
             }
             echo "targetcompo=$targetcompo"
             echo "targetcompo=$targetcompo" | Out-File -Append -FilePath $env:GITHUB_OUTPUT

             echo "targetcompo[0]=$targetcompo[0]"
             echo "targetcompo[1]=$targetcompo[1]"
             echo "targetcompo[2]=$targetcompo[2]"
             
             if ($targetcompo[2] -eq "") {
              $targetcompoA = $targetcompo[0]
              $targetcompoB = $targetcompo[1]
             }else{
              echo "対象コンポが3つ以上あります。エラーを返します。"
              exit 1
             }
             echo "targetcompoA=$targetcompoA"
             echo "targetcompoB=$targetcompoB"
