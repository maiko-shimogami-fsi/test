name: form-example 
on:
 #schedule:
 #   - cron: "0 20 * * *"
 workflow_dispatch:
    inputs:
      input_mod:
        description: 'Please enter the SHA-1 or branch name to UnitTest.'
        required: false
      input_compo:
        description: 'Please enter the compo name to UnitTest.'
        required: false
      input_coretype:
        description: 'Please enter the core type.'
        default: 'cr'
        type: choice
        options:
          - cr
          - ca
          
jobs:
    check-bats-version1:
      runs-on: windows-latest
      outputs:
       targetcompo:  ${{ steps.create_unittest_brach.outputs.targetcompo }}
      
      steps:
      #環境を設定する
        - name: create text
          uses: actions/checkout@v3
        - run: |
             echo "aaa"
             
      #チェック確認
        - name: CRESTE_BRANCH
          id: create_unittest_brach
          run: |
             $targetcompo += "["
             foreach ($l in Get-Content ./unittest_setting.json) {
              if ($l -like "*node_name*") {
                $node_name = $l.Substring(22, ($l.Length-24))
               } elseif ($l -like "*scheduled*") {
                if ($l -like "*true*") {
                  $targetcompo += "`""
                  $targetcompo += $node_name
                  $targetcompo += "`""
                  $targetcompo += ","
                  }
                }
               }
             $targetcompo += "]"
             $targetcompo = $targetcompo -replace '\,]',']'
             echo "targetcompo=$targetcompo"
             echo "targetcompo=$targetcompo" | Out-File -Append -FilePath $env:GITHUB_OUTPUT
            
    check-bats-version2:
      runs-on: ubuntu-latest
      needs: [ check-bats-version1 ]
      strategy:
       max-parallel: 2
       matrix:
         compolist: ${{fromJson( needs.check-bats-version1.outputs.targetcompo )}}
      outputs:
       done: ${{ steps.check2.outputs.message }}
      
      steps:
      #チェック確認
        - name: check2
          uses: actions/checkout@v3
        - run: |
             conv_compo=${{ matrix.compolist }}
             echo "conv_compo=$conv_compo"
             
             if [ $conv_compo = 'Lcd' ]; then
              echo "エラー終了します"
              exit 1
             fi

        - name: check2-1
          if: always()
          run: |
             echo "job.status=${{ job.status }}" 
             if [ ${{ job.status }} = 'failure' ]; then
              echo "エラー"
             fi

    check-bats-version3:
      runs-on: ubuntu-latest
      needs: [ check-bats-version1,check-bats-version2 ]
      if: always()
      strategy:
       max-parallel: 2
       matrix:
         compolist: ${{fromJson( needs.check-bats-version1.outputs.targetcompo )}}
      #continue-on-error: true
      
      steps:
      #チェック確認
        - name: check2
          uses: actions/checkout@v3
        - run: |
             echo "チェック"
